# Cotoka Management System - データベース最適化ガイド

## 概要

このディレクトリには、Cotoka Management System のデータベースを最適化するためのスクリプトとドキュメントが含まれています。データベースの外部キー関係の調整、インデックスの追加、テーブル構造の改善などを実施できます。

## ファイル構成

- `db_optimization.sql` - データベース最適化のためのSQLスクリプト
- `optimized_queries.sql` - 最適化されたクエリのサンプル集
- `optimize_db.php` - データベース最適化を実行するPHPスクリプト
- `db_optimization.md` - データベース最適化の詳細なドキュメント

## 最適化の実行方法

### 準備

1. 最適化を実行する前に、必ずデータベースのバックアップを作成してください。
   ```
   mysqldump -u [ユーザー名] -p [データベース名] > backup_[日付].sql
   ```

2. テスト環境での動作確認を推奨します。

### 最適化スクリプトの実行

1. コマンドラインでディレクトリを移動します：
   ```
   cd /path/to/cotoka_management_system
   ```

2. PHPスクリプトを実行します：
   ```
   php database/optimize_db.php
   ```

3. 実行中に確認メッセージが表示されるので、内容を確認して「y」を入力してください。

4. 実行結果とログが表示されます。エラーがないことを確認してください。

## 最適化の内容

最適化により、以下の改善が行われます：

1. 適切なインデックスの追加による検索性能の向上
2. 外部キー制約の最適化によるデータ整合性の確保
3. 新しいテーブルの追加による機能拡張
4. テーブル構造の改善による保守性の向上

詳細は `db_optimization.md` を参照してください。

## 最適化クエリの利用方法

`optimized_queries.sql` には、パフォーマンスを向上させるための最適化されたクエリが含まれています。これらのクエリは、アプリケーションのコードに組み込むことができます。

## トラブルシューティング

最適化スクリプトの実行中に問題が発生した場合：

1. エラーメッセージを確認してください。
2. バックアップからデータベースを復元します：
   ```
   mysql -u [ユーザー名] -p [データベース名] < backup_[日付].sql
   ```
3. 問題を修正して再実行してください。

## 注意事項

- 実行前に必ずバックアップを作成してください。
- 本番環境で実行する前に、テスト環境でテストしてください。
- データベースの構造が変更される可能性があるため、アプリケーションコードの調整が必要になる場合があります。

## サポート

質問やサポートが必要な場合は、システム管理者にお問い合わせください。 