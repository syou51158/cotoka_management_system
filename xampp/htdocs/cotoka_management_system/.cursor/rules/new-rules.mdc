---
description: COTOKA salon management systemr
globs: 
alwaysApply: false
---
# COTOKAシステム管理ルール
管理システムです
## システム構造ルール
1. テナント（会社）→サロン（店舗）→ユーザー（従業員）の階層構造
2. テナントは複数のサロンを所有できる
3. ユーザーは一つのテナントに所属し、複数のサロンにアクセス可能

## 権限レベルルール
1. **admin**：システム全体管理者、テナントに所属せず全てのサロンにアクセス可能
2. **tenant_admin**：テナント管理者、特定テナントに所属し自社サロンのみ管理可能
3. **manager**：店舗管理者、特定テナントに所属し割り当てられたサロンのみ管理可能
4. **staff**：店舗スタッフ、特定テナントに所属し割り当てられたサロンのみ閲覧/利用可能

## アクセス制御ルール
1. テナント・サロンへのアクセスはuser_salonsテーブルで管理
2. 管理機能へのアクセスはrolesテーブルの権限レベルで制御
3. Remember Me機能によるセッション維持はremember_tokensテーブルで管理

## データベース設計概要
- **tenantsテーブル**：経営主体・会社単位を管理
- **salonsテーブル**：実際の店舗単位を管理
- **usersテーブル**：システムにログインするユーザーを管理
- **rolesテーブル**：ユーザーの権限レベルを管理
- **user_salonsテーブル**：ユーザーとサロンの関連を管理
- **login_attemptsテーブル**：ログイン試行記録の管理
- **remember_tokensテーブル**：自動ログイン用トークン管理
- **system_logsテーブル**：システムログの記録

## 認証・認可機能
- ユーザー認証の強化（classes/User.php）
- 役割ベースのアクセス制御
- Remember Me機能による自動ログイン
- サロンアクセス権限の動的判定
- テナント単位のアクセス制限

## 予約管理ルール
1. 顧客はサロンの特定スタッフに対して特定サービスの予約が可能
2. 予約はステータス（scheduled, confirmed, completed, cancelled, no-show）によって管理
3. 予約確認と予約リマインダーは自動送信機能で管理

## スタッフ管理ルール
1. スタッフは複数のサービスを担当できる（staff_specialtiesテーブルで管理）
2. スタッフのシフトはパターン化して繰り返し適用が可能
3. スタッフの稼働状況はリアルタイムで把握可能

## 顧客管理ルール
1. 顧客情報は各テナント・サロンごとに管理
2. 顧客フィードバックは予約・来店後に記録可能
3. 顧客の来店履歴や購入履歴を一元管理

## 販売・在庫管理ルール
1. サービス販売と商品販売は統合管理（salesテーブル）
2. 在庫アイテムの入出庫は取引タイプ別に追跡可能
3. 決済方法は複数対応（cash, credit_card, debit_card, bank_transfer, digital_wallet, gift_card, other）

## テナント設定ルール
1. テナントごとにカスタム設定が可能（tenant_settingsテーブル）
2. サブスクリプションプランによって利用可能な機能が制限される
3. テナントの契約履歴はサブスクリプション履歴テーブルで管理

## 営業時間管理ルール
1. サロンごとに曜日別の営業時間設定が可能
2. 休憩時間を含めた詳細なタイムスケジュール管理
3. 標準時間枠の設定による予約枠の効率化 